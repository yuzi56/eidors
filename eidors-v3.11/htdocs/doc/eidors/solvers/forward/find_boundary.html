<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of find_boundary</title>
  <meta name="keywords" content="find_boundary">
  <meta name="description" content="[srf, idx] = find_boundary(simp);">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">eidors</a> &gt; <a href="../index.html">solvers</a> &gt; <a href="index.html">forward</a> &gt; find_boundary.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for eidors/solvers/forward&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>find_boundary
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>[srf, idx] = find_boundary(simp);</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function [srf, idx] = find_boundary(simp); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> [srf, idx] = find_boundary(simp);

Caclulates the boundary faces of a given 3D volume.
Usefull in electrode assignment.

srf  =  array of elements on each boundary simplex
        boundary simplices are of 1 lower dimention than simp
idx  =  index of simplex to which each boundary belongs
simp = The simplices matrix

 Also:
  fmdl.boundary = find_boundary(fmdl_old)</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../eidors/eidors_msg.html" class="code" title="function log_level = eidors_msg( message, varargin )">eidors_msg</a>	EIDORS_MSG eidors progress and status messages</li><li><a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li><li><a href="find_boundary.html" class="code" title="function [srf, idx] = find_boundary(simp);">find_boundary</a>	[srf, idx] = find_boundary(simp);</li><li><a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>	UNIT_TEST_CMP: compare matrices in eidors output</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../eidors/deprecated/eidors_model_params.html" class="code" title="function mdl = eidors_model_params( mdl );">eidors_model_params</a>	mdl = eidors_model_params( mdl );</li><li><a href="../../../eidors/deprecated/np_fwd_parameters.html" class="code" title="function param = np_fwd_parameters( fwd_model )">np_fwd_parameters</a>	NP_FWD_PARAMETERS: data= np_fwd_solve( fwd_model )</li><li><a href="../../../eidors/deprecated/np_fwd_solve.html" class="code" title="function data= np_fwd_solve( fwd_model, img)">np_fwd_solve</a>	NP_FWD_SOLVE: data= np_fwd_solve( fwd_model, img)</li><li><a href="../../../eidors/deprecated/set_fwd_model.html" class="code" title="function [fwd_mdl]=set_fwd_model(vtx,simp,srf,elec,zc,gnd_ind,Ib,indH,df,perm_sym);">set_fwd_model</a>	SET_FWD_MODEL: create EIDORS v3 fwd_model from v2 parameters</li><li><a href="../../../eidors/examples/demo_real.html" class="code" title="function [inhomg_img, demo_img] = demo_real;">demo_real</a>	[inhomg_img, demo_img] = demo_real;</li><li><a href="../../../eidors/graphics/matlab/mdl_slice_mapper.html" class="code" title="function map = mdl_slice_mapper( fmdl, maptype )">mdl_slice_mapper</a>	MDL_SLICE_MAPPER: map pixels to FEM elements or nodes</li><li><a href="../../../eidors/graphics/matlab/show_3d_slices.html" class="code" title="function h = show_3d_slices(img, varargin);">show_3d_slices</a>	show_3d_slices(img, z_cuts, x_cuts, y_cuts, any_cuts)</li><li><a href="../../../eidors/graphics/matlab/show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>	SHOW_FEM: show the EIDORS3D finite element model</li><li><a href="../../../eidors/meshing/distmesh/dm_2d_pt_elecs.html" class="code" title="function fmdl = dm_2d_pt_elecs( elec_pts, pfix, params, shapefn, bbox);">dm_2d_pt_elecs</a>	DM_2D_PT_ELECS: Create circle mesh (or radius 1) refined</li><li><a href="../../../eidors/meshing/distmesh/dm_mk_fwd_model.html" class="code" title="function [fwd_mdl]= dm_mk_fwd_model( fd, fh, nnodes, bbox, elec_nodes,refine_nodes, z_contact, name)">dm_mk_fwd_model</a>	DM_MK_FWD_MODEL: create a fwd_model object using distmesh</li><li><a href="../../../eidors/meshing/gmsh/gmsh_mk_fwd_model.html" class="code" title="function [fwd_mdl, mat_indices]=gmsh_mk_fwd_model( vol_filename, name, eprefix,stim_pattern, z_contact)">gmsh_mk_fwd_model</a>	GMSH_MK_FWD_MODEL: create a fwd_model object from a Gmsh file</li><li><a href="../../../eidors/meshing/join_models.html" class="code" title="function [fmdlo]= join_models(fmdl1, fmdl2, tol)">join_models</a>	JOIN_MODELS: Join two fmdl structures to create one</li><li><a href="../../../eidors/meshing/netgen/mdl2d_from3d.html" class="code" title="function mdl2 = mdl2d_from3d(mdl3);">mdl2d_from3d</a>	mdl2d_from3d: Create 2D mdl from z=0 plane of 3d model</li><li><a href="../../../eidors/meshing/netgen/ng_mk_2d_model.html" class="code" title="function mdl = ng_mk_2d_model(varargin)">ng_mk_2d_model</a>	NG_MG_2D_MODELS create a 2D mesh with Netgen via the in2d interface</li><li><a href="../../../eidors/meshing/netgen/ng_mk_extruded_model.html" class="code" title="function [fmdl,mat_idx] = ng_mk_extruded_model(shape, elec_pos, elec_shape,extra_ng_code)">ng_mk_extruded_model</a>	NG_MAKE_EXTRUDED_MODEL: create extruded models using netgen</li><li><a href="../../../eidors/meshing/stl/stl_read.html" class="code" title="function mdl = stl_read(fname)">stl_read</a>	STL_READ  Read in an stl file and output an EIDORS model struct</li><li><a href="../../../eidors/models/GREIT3D_distribution.html" class="code" title="function [imdl,distr] = GREIT3D_distribution(fmdl, vopt)">GREIT3D_distribution</a>	GREIT3D_distribution: create target distributions for 3D GREIT</li><li><a href="../../../eidors/models/fix_model.html" class="code" title="function [mdl] = fix_model(mdl,opt)">fix_model</a>	FIX_MODEL: Add useful fields to a model</li><li><a href="../../../eidors/models/fwd_model_from_v2.html" class="code" title="function fmdl = fwd_model_from_v2( elec, vtx, bdy, simp, zc, gnd_ind, name)">fwd_model_from_v2</a>	CREATE EIDORS v3 fwd_model from the v2 variables</li><li><a href="../../../eidors/models/merge_meshes.html" class="code" title="function out = merge_meshes(M1,varargin)">merge_meshes</a>	MERGE_MESHES - merges two meshes based on common nodes</li><li><a href="../../../eidors/models/mk_GREIT_model.html" class="code" title="function [imdl, weight]= mk_GREIT_model( fmdl, radius, weight, options )">mk_GREIT_model</a>	MK_GREIT_MODEL: make EIDORS inverse models using the GREIT approach</li><li><a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li><li><a href="../../../eidors/models/mk_fmdl_from_nodes.html" class="code" title="function mdl= mk_fmdl_from_nodes( vtx, elec_nodes, z_contact, name)">mk_fmdl_from_nodes</a>	MK_FMDL_FROM_NODES: create fmdl from nodes</li><li><a href="../../../eidors/models/mk_geophysics_model.html" class="code" title="function imdl = mk_geophysics_model(str, ne, opt);">mk_geophysics_model</a>	imdl = mk_geophysics_model(str, ne, [option])</li><li><a href="../../../eidors/models/mk_grid_c2f.html" class="code" title="function [c2f, m] = mk_grid_c2f(fmdl, rmdl, opt)">mk_grid_c2f</a>	MK_GRID_C2F - calculate a coarse2fine mapping for grid coarse models.</li><li><a href="../../../eidors/models/mk_grid_model.html" class="code" title="function [cmdl, c2f]= mk_grid_model(fmdl, xvec, yvec, zvec);">mk_grid_model</a>	MK_GRID_MODEL: Create reconstruction model on pixelated grid</li><li><a href="../../../eidors/models/mk_hollow_electrode.html" class="code" title="function fmdl = mk_hollow_electrode(fmdl, elec_idx)">mk_hollow_electrode</a>	MK_HOLLOW_ELECTRODE: remove nodes with indicated electrdoes</li><li><a href="../../../eidors/models/mk_pixel_slice.html" class="code" title="function [imdl fmdl] = mk_pixel_slice(imdl,level,opt)">mk_pixel_slice</a>	MK_PIXEL_SLICE create a pixel model to reconstruct on</li><li><a href="../../../eidors/models/solve_RM_2Dslice.html" class="code" title="function imdl = solve_RM_2Dslice(imdl, sel_fcn)">solve_RM_2Dslice</a>	SOLVE_RM_2DSLICE: cut slices out of a 3D model</li><li><a href="find_boundary.html" class="code" title="function [srf, idx] = find_boundary(simp);">find_boundary</a>	[srf, idx] = find_boundary(simp);</li><li><a href="fwd_model_parameters.html" class="code" title="function param = fwd_model_parameters( fwd_model, opt )">fwd_model_parameters</a>	FWD_MODEL_PARAMETERS: data= fwd_solve_1st_order( fwd_model, image)</li><li><a href="fwd_solve_1st_order.html" class="code" title="function data =fwd_solve_1st_order(fwd_model, img)">fwd_solve_1st_order</a>	FWD_SOLVE_1ST_ORDER: data= fwd_solve_1st_order( img)</li><li><a href="system_mat_1st_order.html" class="code" title="function s_mat= system_mat_1st_order( fwd_model, img)">system_mat_1st_order</a>	SYSTEM_MAT_1ST_ORDER: SS= system_mat_1st_order( fwd_model, img)</li><li><a href="system_mat_fields.html" class="code" title="function FC= system_mat_fields( fwd_model )">system_mat_fields</a>	SYSTEM_MAT_FIELDS: fields (elem to nodes) fraction of system mat</li><li><a href="../../../eidors/solvers/inverse/calc_image_SNR.html" class="code" title="function [SNRmean, SE, debug] = calc_image_SNR(imdl, hyperparameter, doPlot)">calc_image_SNR</a>	% CALC_IMAGE_SNR: Calculates the signal-to-noise ratio (SNR) in the image</li><li><a href="../../../eidors/tests/demo_real_test2.html" class="code" title="function ok= demo_real_test2">demo_real_test2</a>	Perform tests based on the demo_real function with new structs</li><li><a href="../../../eidors/tests/demo_real_test3.html" class="code" title="function ok= demo_real_test3">demo_real_test3</a>	Perform tests based on the demo_real function with new structs</li><li><a href="../../../eidors/tests/test_3d_resistor.html" class="code" title="function test_3d_resistor">test_3d_resistor</a>	Create 3D model of a Rectangular resistor</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function [srf,idx]= find_2or3d_boundary(simp,dim);</a></li><li><a href="#_sub2" class="code">function [srf,idx]= find_1d_boundary(simp);</a></li><li><a href="#_sub3" class="code">function x = isunique(a);</a></li><li><a href="#_sub4" class="code">function do_unit_test</a></li><li><a href="#_sub5" class="code">function bdy= sort_boundary(bdy)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function [srf, idx] = find_boundary(simp);</a>
0002 <span class="comment">% [srf, idx] = find_boundary(simp);</span>
0003 <span class="comment">%</span>
0004 <span class="comment">%Caclulates the boundary faces of a given 3D volume.</span>
0005 <span class="comment">%Usefull in electrode assignment.</span>
0006 <span class="comment">%</span>
0007 <span class="comment">%srf  =  array of elements on each boundary simplex</span>
0008 <span class="comment">%        boundary simplices are of 1 lower dimention than simp</span>
0009 <span class="comment">%idx  =  index of simplex to which each boundary belongs</span>
0010 <span class="comment">%simp = The simplices matrix</span>
0011 <span class="comment">%</span>
0012 <span class="comment">% Also:</span>
0013 <span class="comment">%  fmdl.boundary = find_boundary(fmdl_old)</span>
0014 
0015 <span class="comment">% $Id: find_boundary.m 6354 2022-05-01 16:15:26Z aadler $</span>
0016 
0017 <span class="keyword">if</span> ischar(simp) &amp;&amp; strcmp(simp,<span class="string">'UNIT_TEST'</span>); <a href="#_sub4" class="code" title="subfunction do_unit_test">do_unit_test</a>; <span class="keyword">return</span>; <span class="keyword">end</span>
0018 <span class="keyword">if</span> isstruct(simp) &amp;&amp; strcmp(simp.type,<span class="string">'fwd_model'</span>); simp= simp.elems; <span class="keyword">end</span>
0019 
0020 wew = size(simp,2) - 1;
0021 
0022 <span class="keyword">if</span> wew==3 || wew==2
0023    [srf,idx]= <a href="#_sub1" class="code" title="subfunction [srf,idx]= find_2or3d_boundary(simp,dim);">find_2or3d_boundary</a>(simp,wew);
0024 <span class="keyword">elseif</span> wew == 1
0025    [srf,idx]= <a href="#_sub2" class="code" title="subfunction [srf,idx]= find_1d_boundary(simp);">find_1d_boundary</a>(simp);
0026 <span class="keyword">else</span>
0027    <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level = eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'find_boundary: WARNING: not 1D, 2D or 3D simplices'</span>,1);
0028    srf=[]; <span class="keyword">return</span>;
0029 <span class="keyword">end</span>
0030 
0031 <span class="comment">% sort surfaces. If there is more than one, its not on the boundary</span>
0032 <a name="_sub1" href="#_subfunctions" class="code">function [srf,idx]= find_2or3d_boundary(simp,dim);</a>
0033    <span class="keyword">if</span> size(simp,1) &lt; 4e9 <span class="comment">% max of uint32</span>
0034       <span class="comment">% convert to integer to make sort faster</span>
0035       simp = uint32( simp );
0036    <span class="keyword">end</span>
0037    localface = nchoosek(1:dim+1,dim);
0038    srf_local= simp(:,localface');
0039    srf_local= reshape( srf_local', dim, []); <span class="comment">% D x 3E</span>
0040    srf_local= sort(srf_local)'; <span class="comment">% Sort each row</span>
0041    [sort_srl,sort_idx] = sortrows( srf_local );
0042 
0043    <span class="comment">% Fine the ones that are the same</span>
0044    first_ones =  sort_srl(1:end-1,:);
0045    next_ones  =  sort_srl(2:<span class="keyword">end</span>,:);
0046    same_srl = find( all( first_ones == next_ones, 2) );
0047 
0048    <span class="comment">% Assume they're all different. then find the same ones</span>
0049    diff_srl = logical(ones(size(srf_local,1),1));
0050    diff_srl(same_srl) = 0;
0051    diff_srl(same_srl+1) = 0;
0052 
0053    srf= sort_srl( diff_srl,: );
0054    idx= sort_idx( diff_srl);
0055    idx= ceil(idx/(dim+1));
0056 
0057 <a name="_sub2" href="#_subfunctions" class="code">function [srf,idx]= find_1d_boundary(simp);</a>
0058    <span class="keyword">if</span> size(simp,1) &lt; 4e9 <span class="comment">% max of uint32</span>
0059       <span class="comment">% convert to integer to make sort faster</span>
0060       simp = uint32( simp );
0061    <span class="keyword">end</span>
0062    <span class="comment">% we expect two nodes as a result</span>
0063    idx = find(<a href="#_sub3" class="code" title="subfunction x = isunique(a);">isunique</a>(simp(:)) == 1);
0064    srf = simp(idx);
0065    idx = rem(idx-1,size(simp,1))+1;
0066 
0067 <a name="_sub3" href="#_subfunctions" class="code">function x = isunique(a);</a>
0068    u=unique(a);
0069    n=histc(a,u);
0070    x=ismember(a,u(n==1));
0071 
0072 <a name="_sub4" href="#_subfunctions" class="code">function do_unit_test</a>
0073 
0074 <span class="comment">%2D Test:</span>
0075 mdl = <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'c2c'</span>,16);
0076 bdy = <a href="find_boundary.html" class="code" title="function [srf, idx] = find_boundary(simp);">find_boundary</a>(mdl.fwd_model.elems);
0077 bdy = <a href="#_sub5" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(bdy);
0078 bdyc= <a href="#_sub5" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(mdl.fwd_model.boundary);
0079 
0080 <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'2D test'</span>, bdy, bdyc);
0081 
0082 <span class="comment">%3D Test:</span>
0083 mdl = <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'n3r2'</span>,[16,2]);
0084 bdy = <a href="find_boundary.html" class="code" title="function [srf, idx] = find_boundary(simp);">find_boundary</a>(mdl.fwd_model.elems);
0085 bdy = <a href="#_sub5" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(bdy);
0086 bdyc= <a href="#_sub5" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(mdl.fwd_model.boundary);
0087 
0088 <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>( <span class="string">'3D test n3r2'</span>, bdy,bdyc);
0089 
0090 <span class="comment">%3D Test:</span>
0091 mdl = <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'a3cr'</span>,16);
0092 bdy = <a href="find_boundary.html" class="code" title="function [srf, idx] = find_boundary(simp);">find_boundary</a>(mdl.fwd_model.elems);
0093 bdy = <a href="#_sub5" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(bdy);
0094 bdyc= <a href="#_sub5" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(mdl.fwd_model.boundary);
0095 
0096 <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'3D test a3c2'</span>, bdy, bdyc);
0097 
0098 <span class="comment">%3D Test:</span>
0099 mdl = <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'b3cr'</span>,16);
0100 bdy = <a href="find_boundary.html" class="code" title="function [srf, idx] = find_boundary(simp);">find_boundary</a>(mdl.fwd_model.elems);
0101 bdy = <a href="#_sub5" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(bdy);
0102 bdyc= <a href="#_sub5" class="code" title="subfunction bdy= sort_boundary(bdy)">sort_boundary</a>(mdl.fwd_model.boundary);
0103 
0104 <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'3D test b3c2'</span>, bdy, bdyc);
0105 
0106 simp = [  10 190; <span class="keyword">...</span>
0107          182 183; <span class="keyword">...</span>
0108          183 184; <span class="keyword">...</span>
0109          184 185; <span class="keyword">...</span>
0110           11 182; <span class="keyword">...</span>
0111          185 186; <span class="keyword">...</span>
0112          187 186; <span class="keyword">...</span>
0113          187 188; <span class="keyword">...</span>
0114          188 189; <span class="keyword">...</span>
0115          189 190];
0116 [bdy, idx] = <a href="find_boundary.html" class="code" title="function [srf, idx] = find_boundary(simp);">find_boundary</a>(simp);
0117 <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'1D bdy'</span>, bdy,[10;11]);
0118 <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'1D bdy'</span>, idx,[1;5]);
0119 
0120 <a name="_sub5" href="#_subfunctions" class="code">function bdy= sort_boundary(bdy)</a>
0121    bdy = sort(bdy,2);
0122    bdy = sortrows(bdy);
0123</pre></div>
<hr><address>Generated on Fri 30-Dec-2022 20:46:51 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>