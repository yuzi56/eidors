<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of GREIT_desired_img_FEMmesh</title>
  <meta name="keywords" content="GREIT_desired_img_FEMmesh">
  <meta name="description" content="GREIT_DESIRED_IMG_FEMmesh  GREIT onto a FEM mesh">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">eidors</a> &gt; <a href="../index.html">solvers</a> &gt; <a href="index.html">inverse</a> &gt; GREIT_desired_img_FEMmesh.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for eidors/solvers/inverse&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>GREIT_desired_img_FEMmesh
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>GREIT_DESIRED_IMG_FEMmesh  GREIT onto a FEM mesh</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function PSF= GREIT_desired_img_FEMmesh(xyc, radius, opt) </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment">GREIT_DESIRED_IMG_FEMmesh  GREIT onto a FEM mesh
 PSF= GREIT_desired_img_FEMmesh(xyc, radius, opt)
   xyc     - array of point centers [2xNpoints]
   radius  - the radius of the target on the desired image as a fraction
             of the model radius (half the larger dimension in xy)
   opt     - a struct with these mandatory fields:
      .rec_model   a 2D model as generated by MK_GRID_MODEL, with some
                   restrictions, see below. 

 Generates the GREIT &quot;desired img&quot; mapped onto the centres
   of the elements specified in opt.rec_model. It is assumed
   the radius is larger than the element size, so only the
   element centres are relevant

 See also: <a href="calc_GREIT_RM.html" class="code" title="function [RM, PJt, M] = calc_GREIT_RM(vh,vi, xyc, radius, weight, options)">CALC_GREIT_RM</a>, MK_GREIT_MODEL, MK_PIXEL_SLICE,
           <a href="GREIT_desired_img_sigmoid.html" class="code" title="function PSF = GREIT_desired_img_sigmoid(xyz,radius, opt)">GREIT_DESIRED_IMG_SIGMOID</a> <a href="GREIT_desired_img_original.html" class="code" title="function PSF= GREIT_desired_img_original(xyc, radius, opt)">GREIT_DESIRED_IMG_ORIGINAL</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../eidors/eidors_obj.html" class="code" title="function [obj_id, extra_out] = eidors_obj(type,name, varargin )">eidors_obj</a>	EIDORS_OBJ: maintains EIDORS internals</li><li><a href="../../../eidors/graphics/matlab/show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>	SHOW_FEM: show the EIDORS3D finite element model</li><li><a href="../../../eidors/meshing/netgen/ng_mk_cyl_models.html" class="code" title="function [fmdl,mat_idx] = ng_mk_cyl_models(cyl_shape, elec_pos,elec_shape, extra_ng_code);">ng_mk_cyl_models</a>	NG_MAKE_CYL_MODELS: create cylindrical models using netgen</li><li><a href="../../../eidors/models/interp_mesh.html" class="code" title="function mdl_pts = interp_mesh( mdl, n_interp)">interp_mesh</a>	INTERP_MESH: calculate interpolation points onto mdl elements</li><li><a href="../../../eidors/models/mk_GREIT_model.html" class="code" title="function [imdl, weight]= mk_GREIT_model( fmdl, radius, weight, options )">mk_GREIT_model</a>	MK_GREIT_MODEL: make EIDORS inverse models using the GREIT approach</li><li><a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li><li><a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>	MK_IMAGE: create eidors image object</li><li><a href="../../../eidors/models/mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>	MK_STIM_PATTERNS: create an EIDORS stimulation pattern structure</li><li><a href="../../../eidors/models/num_elems.html" class="code" title="function num = num_elems( mdl );">num_elems</a>	NUM_ELEMS: number of elemnts in a (fwd or inv model or image)</li><li><a href="../../../eidors/solvers/fwd_solve.html" class="code" title="function data = fwd_solve(fwd_model, img)">fwd_solve</a>	FWD_SOLVE: calculate data from a fwd_model object and an image</li><li><a href="../../../eidors/solvers/inv_solve.html" class="code" title="function img = inv_solve( inv_model, data1, data2)">inv_solve</a>	INV_SOLVE: calculate imag from an inv_model and data</li><li><a href="GREIT_desired_img_FEMmesh.html" class="code" title="function PSF= GREIT_desired_img_FEMmesh(xyc, radius, opt)">GREIT_desired_img_FEMmesh</a>	GREIT_DESIRED_IMG_FEMmesh  GREIT onto a FEM mesh</li><li><a href="GREIT_desired_img_original.html" class="code" title="function PSF= GREIT_desired_img_original(xyc, radius, opt)">GREIT_desired_img_original</a>	GREIT_DESIRED_IMG_ORIGINAL The original desired solution for GREIT</li><li><a href="calc_noise_figure.html" class="code" title="function [NF,SE] = calc_noise_figure( inv_model, hp, iterations)">calc_noise_figure</a>	CALC_NOISE_FIGURE: calculate the noise amplification (NF) of an algorithm</li><li><a href="../../../eidors/tools/eidors_cache.html" class="code" title="function varargout=eidors_cache( command, varargin )">eidors_cache</a>	EIDORS_CACHE Control eidors caching</li><li><a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>	UNIT_TEST_CMP: compare matrices in eidors output</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="GREIT_desired_img_FEMmesh.html" class="code" title="function PSF= GREIT_desired_img_FEMmesh(xyc, radius, opt)">GREIT_desired_img_FEMmesh</a>	GREIT_DESIRED_IMG_FEMmesh  GREIT onto a FEM mesh</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function PSF = desired_soln(xyc,radius,opt)</a></li><li><a href="#_sub2" class="code">function do_unit_test</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function PSF= GREIT_desired_img_FEMmesh(xyc, radius, opt)</a>
0002 <span class="comment">%GREIT_DESIRED_IMG_FEMmesh  GREIT onto a FEM mesh</span>
0003 <span class="comment">% PSF= GREIT_desired_img_FEMmesh(xyc, radius, opt)</span>
0004 <span class="comment">%   xyc     - array of point centers [2xNpoints]</span>
0005 <span class="comment">%   radius  - the radius of the target on the desired image as a fraction</span>
0006 <span class="comment">%             of the model radius (half the larger dimension in xy)</span>
0007 <span class="comment">%   opt     - a struct with these mandatory fields:</span>
0008 <span class="comment">%      .rec_model   a 2D model as generated by MK_GRID_MODEL, with some</span>
0009 <span class="comment">%                   restrictions, see below.</span>
0010 <span class="comment">%</span>
0011 <span class="comment">% Generates the GREIT &quot;desired img&quot; mapped onto the centres</span>
0012 <span class="comment">%   of the elements specified in opt.rec_model. It is assumed</span>
0013 <span class="comment">%   the radius is larger than the element size, so only the</span>
0014 <span class="comment">%   element centres are relevant</span>
0015 <span class="comment">%</span>
0016 <span class="comment">% See also: CALC_GREIT_RM, MK_GREIT_MODEL, MK_PIXEL_SLICE,</span>
0017 <span class="comment">%           GREIT_DESIRED_IMG_SIGMOID GREIT_DESIRED_IMG_ORIGINAL</span>
0018 
0019 <span class="comment">% (C) 2009-2015 Andy Adler and Bartlomiej Grychtol.</span>
0020 <span class="comment">% License: GPL v2 or v3</span>
0021 <span class="comment">% $Id: GREIT_desired_img_FEMmesh.m 5868 2018-12-15 12:00:35Z aadler $</span>
0022    <span class="keyword">if</span> ischar(xyc) &amp;&amp; strcmp(xyc,<span class="string">'UNIT_TEST'</span>); <a href="#_sub2" class="code" title="subfunction do_unit_test">do_unit_test</a>; <span class="keyword">return</span>; <span class="keyword">end</span>
0023 
0024    copt.fstr = <span class="string">'GREIT_desired_img_FEMmesh'</span>;
0025    copt.cache_obj = {xyc, radius, opt};
0026    PSF = <a href="../../../eidors/tools/eidors_cache.html" class="code" title="function varargout=eidors_cache( command, varargin )">eidors_cache</a>(@<a href="#_sub1" class="code" title="subfunction PSF = desired_soln(xyc,radius,opt)">desired_soln</a>,{xyc, radius, opt},copt);
0027 <span class="keyword">end</span>
0028 
0029 <a name="_sub1" href="#_subfunctions" class="code">function PSF = desired_soln(xyc,radius,opt)</a>
0030    
0031    opt.inside = opt.rec_model.inside;
0032    mxyc = <a href="../../../eidors/models/interp_mesh.html" class="code" title="function mdl_pts = interp_mesh( mdl, n_interp)">interp_mesh</a>(opt.rec_model); x=mxyc(:,1); y=mxyc(:,2);
0033    xmin = opt.meshsz(1); xmax = opt.meshsz(2);
0034    ymin = opt.meshsz(3); ymax = opt.meshsz(4);
0035    <span class="comment">% scale radius to half the greater dimension</span>
0036    radius = radius * 0.5 * max(xmax-xmin, ymax-ymin);
0037    PSF = zeros(size(x,1),size(xyc,2));
0038    x_spc = (xmax-xmin)/(opt.imgsz(1)-1) * 0.5;
0039    y_spc = (ymax-ymin)/(opt.imgsz(2)-1) * 0.5;
0040    <span class="keyword">for</span> i=1:size(xyc,2);
0041       <span class="keyword">for</span> dx = linspace(-x_spc, x_spc, 5)
0042          <span class="keyword">for</span> dy = linspace(-y_spc, y_spc, 5)
0043             PSF(:,i) = PSF(:,i) +  1/25*( <span class="keyword">...</span>
0044                (dx+x(:)-xyc(1,i)).^2 + (dy+y(:)-xyc(2,i)).^2 <span class="keyword">...</span>
0045                         &lt; radius^2 );
0046          <span class="keyword">end</span>
0047       <span class="keyword">end</span>
0048 <span class="comment">%     PSF(:,i) = PSF(:,i)/sum(PSF(:,i));</span>
0049    <span class="keyword">end</span>
0050    PSF = PSF(opt.inside,:);
0051 <span class="keyword">end</span>
0052 
0053 <a name="_sub2" href="#_subfunctions" class="code">function do_unit_test</a>
0054    img=<a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>(<a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'d2c2'</span>,32)); vh=<a href="../../../eidors/solvers/fwd_solve.html" class="code" title="function data = fwd_solve(fwd_model, img)">fwd_solve</a>(img);
0055    img.elem_data(206)=1.1;                    vi=<a href="../../../eidors/solvers/fwd_solve.html" class="code" title="function data = fwd_solve(fwd_model, img)">fwd_solve</a>(img);
0056 
0057    fm = <a href="../../../eidors/meshing/netgen/ng_mk_cyl_models.html" class="code" title="function [fmdl,mat_idx] = ng_mk_cyl_models(cyl_shape, elec_pos,elec_shape, extra_ng_code);">ng_mk_cyl_models</a>(0.2,[32,0.1],[0.05]);
0058    fm.stimulation = <a href="../../../eidors/models/mk_stim_patterns.html" class="code" title="function [stim, meas_sel]= mk_stim_patterns(n_elec, n_rings, inj, meas, options, amplitude)">mk_stim_patterns</a>(32,1,[0,1],[0,1],{},1);
0059    imdl= <a href="../../../eidors/eidors_obj.html" class="code" title="function [obj_id, extra_out] = eidors_obj(type,name, varargin )">eidors_obj</a>(<span class="string">'inv_model'</span>,<span class="string">''</span>,<span class="string">'fwd_model'</span>,fm);
0060    imdl.jacobian_bkgnd.value = 1;
0061    opt.desired_solution_fn = @<a href="GREIT_desired_img_original.html" class="code" title="function PSF= GREIT_desired_img_original(xyc, radius, opt)">GREIT_desired_img_original</a>;
0062    imdl  = <a href="../../../eidors/models/mk_GREIT_model.html" class="code" title="function [imdl, weight]= mk_GREIT_model( fmdl, radius, weight, options )">mk_GREIT_model</a>(imdl,0.20,1e1,opt);
0063    imgr = <a href="../../../eidors/solvers/inv_solve.html" class="code" title="function img = inv_solve( inv_model, data1, data2)">inv_solve</a>(imdl,vh,vi); subplot(121); <a href="../../../eidors/graphics/matlab/show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(imgr);
0064    disp(<a href="calc_noise_figure.html" class="code" title="function [NF,SE] = calc_noise_figure( inv_model, hp, iterations)">calc_noise_figure</a>(imdl,vh,vi))
0065 
0066    [~,idx] = sort(-imgr.elem_data);
0067    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'[...]_img_original'</span>,idx(1:10), <span class="keyword">...</span>
0068          [365 366 333 334 398 397 364 367 332 399]');
0069 
0070    imdl.rec_model = img.fwd_model;
0071    imdl.rec_model.inside = true(<a href="../../../eidors/models/num_elems.html" class="code" title="function num = num_elems( mdl );">num_elems</a>(img),1);
0072    opt.desired_solution_fn = @<a href="GREIT_desired_img_FEMmesh.html" class="code" title="function PSF= GREIT_desired_img_FEMmesh(xyc, radius, opt)">GREIT_desired_img_FEMmesh</a>;
0073    imdl  = <a href="../../../eidors/models/mk_GREIT_model.html" class="code" title="function [imdl, weight]= mk_GREIT_model( fmdl, radius, weight, options )">mk_GREIT_model</a>(imdl,0.20,1e1,opt);
0074    imgr = <a href="../../../eidors/solvers/inv_solve.html" class="code" title="function img = inv_solve( inv_model, data1, data2)">inv_solve</a>(imdl,vh,vi); subplot(122); <a href="../../../eidors/graphics/matlab/show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(imgr);
0075    disp(<a href="calc_noise_figure.html" class="code" title="function [NF,SE] = calc_noise_figure( inv_model, hp, iterations)">calc_noise_figure</a>(imdl,vh,vi))
0076 
0077    [~,idx] = sort(-imgr.elem_data);
0078    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'[...]_img_FEMmesh'</span>,idx(1:10), <span class="keyword">...</span>
0079          [235 206 267 236 178 301 205 268 152 300]');
0080 
0081 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Fri 30-Dec-2022 20:46:51 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>