<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of dm_2d_circ_pt_elecs</title>
  <meta name="keywords" content="dm_2d_circ_pt_elecs">
  <meta name="description" content="DM_2D_CIRC_PT_ELECS: Create circle mesh (or radius 1) refined with electrodes">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">eidors</a> &gt; <a href="../index.html">meshing</a> &gt; <a href="index.html">distmesh</a> &gt; dm_2d_circ_pt_elecs.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for eidors/meshing/distmesh&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>dm_2d_circ_pt_elecs
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>DM_2D_CIRC_PT_ELECS: Create circle mesh (or radius 1) refined with electrodes</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function fmdl = dm_2d_circ_pt_elecs( elec_pts, pfix, spacing); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> DM_2D_CIRC_PT_ELECS: Create circle mesh (or radius 1) refined with electrodes
 fmdl = dm_2d_circ_pt_elecs( elec_pts, pfix, spacing);
     at points on the electrodes
 fmdl = dm_2d_circ_pt_elecs( elec_pts, pfix, ...
               [base_spacing, refine_ratio, gradient]);
 elec_pts = cell fcn of N x [x,y,{z}] for each electrode
    normally only two points are specified (at start and end of electrode)
    eg elec_pts{1} = [-.1,1;.1,1];
 pfix = any fixed points to provide to the model (default = [])
 param(1) = base_spacing - edge length away from refined nodes (eg 0.1)
 param(2) = refine_ratio - relative refinement near points (eg. 10)
 param(3) = gradient     - transition slope of refinement (eg 0.1)

 Example: Three electrodes 2 on boundary and one internal
  elec_pts = {[1,0],[0,1;sin(0.2),cos(0.2)],[0.5,0.5]};
  fmdl= dm_2d_circ_pt_elecs( elec_pts, [], [0.15,10,0.05] );

 Example:
  n_elecs= 14; elec_width= 0.1; hw= elec_width/2;
  th = linspace(0,2*pi,n_elecs+1); th(end)=[];
  for i=1:n_elecs;
     ti = th(i) + [hw;-hw];
     elec_pts{i} = [sin(ti),cos(ti)];
  end
  fmdl= dm_2d_circ_pt_elecs( elec_pts, [], [0.10,10,0.02] );

 See also: <a href="dm_2d_pt_elecs.html" class="code" title="function fmdl = dm_2d_pt_elecs( elec_pts, pfix, params, shapefn, bbox);">dm_2d_pt_elecs</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../eidors/eidors_msg.html" class="code" title="function log_level = eidors_msg( message, varargin )">eidors_msg</a>	EIDORS_MSG eidors progress and status messages</li><li><a href="../../../eidors/graphics/matlab/show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>	SHOW_FEM: show the EIDORS3D finite element model</li><li><a href="dm_2d_circ_pt_elecs.html" class="code" title="function fmdl = dm_2d_circ_pt_elecs( elec_pts, pfix, spacing);">dm_2d_circ_pt_elecs</a>	DM_2D_CIRC_PT_ELECS: Create circle mesh (or radius 1) refined with electrodes</li><li><a href="dm_2d_pt_elecs.html" class="code" title="function fmdl = dm_2d_pt_elecs( elec_pts, pfix, params, shapefn, bbox);">dm_2d_pt_elecs</a>	DM_2D_PT_ELECS: Create circle mesh (or radius 1) refined</li><li><a href="../../../eidors/tools/eidors_cache.html" class="code" title="function varargout=eidors_cache( command, varargin )">eidors_cache</a>	EIDORS_CACHE Control eidors caching</li><li><a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>	UNIT_TEST_CMP: compare matrices in eidors output</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="dm_2d_circ_pt_elecs.html" class="code" title="function fmdl = dm_2d_circ_pt_elecs( elec_pts, pfix, spacing);">dm_2d_circ_pt_elecs</a>	DM_2D_CIRC_PT_ELECS: Create circle mesh (or radius 1) refined with electrodes</li><li><a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function fmdl = do_circ_pt_elecs( elec_pts, pfix, spacing )</a></li><li><a href="#_sub2" class="code">function d= circle(p,params);</a></li><li><a href="#_sub3" class="code">function do_unit_test</a></li><li><a href="#_sub4" class="code">function do_calibrate</a></li><li><a href="#_sub5" class="code">function meas = calc_range(p1range,p2,p3)</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function fmdl = dm_2d_circ_pt_elecs( elec_pts, pfix, spacing);</a>
0002 <span class="comment">% DM_2D_CIRC_PT_ELECS: Create circle mesh (or radius 1) refined with electrodes</span>
0003 <span class="comment">% fmdl = dm_2d_circ_pt_elecs( elec_pts, pfix, spacing);</span>
0004 <span class="comment">%     at points on the electrodes</span>
0005 <span class="comment">% fmdl = dm_2d_circ_pt_elecs( elec_pts, pfix, ...</span>
0006 <span class="comment">%               [base_spacing, refine_ratio, gradient]);</span>
0007 <span class="comment">% elec_pts = cell fcn of N x [x,y,{z}] for each electrode</span>
0008 <span class="comment">%    normally only two points are specified (at start and end of electrode)</span>
0009 <span class="comment">%    eg elec_pts{1} = [-.1,1;.1,1];</span>
0010 <span class="comment">% pfix = any fixed points to provide to the model (default = [])</span>
0011 <span class="comment">% param(1) = base_spacing - edge length away from refined nodes (eg 0.1)</span>
0012 <span class="comment">% param(2) = refine_ratio - relative refinement near points (eg. 10)</span>
0013 <span class="comment">% param(3) = gradient     - transition slope of refinement (eg 0.1)</span>
0014 <span class="comment">%</span>
0015 <span class="comment">% Example: Three electrodes 2 on boundary and one internal</span>
0016 <span class="comment">%  elec_pts = {[1,0],[0,1;sin(0.2),cos(0.2)],[0.5,0.5]};</span>
0017 <span class="comment">%  fmdl= dm_2d_circ_pt_elecs( elec_pts, [], [0.15,10,0.05] );</span>
0018 <span class="comment">%</span>
0019 <span class="comment">% Example:</span>
0020 <span class="comment">%  n_elecs= 14; elec_width= 0.1; hw= elec_width/2;</span>
0021 <span class="comment">%  th = linspace(0,2*pi,n_elecs+1); th(end)=[];</span>
0022 <span class="comment">%  for i=1:n_elecs;</span>
0023 <span class="comment">%     ti = th(i) + [hw;-hw];</span>
0024 <span class="comment">%     elec_pts{i} = [sin(ti),cos(ti)];</span>
0025 <span class="comment">%  end</span>
0026 <span class="comment">%  fmdl= dm_2d_circ_pt_elecs( elec_pts, [], [0.10,10,0.02] );</span>
0027 <span class="comment">%</span>
0028 <span class="comment">% See also: dm_2d_pt_elecs</span>
0029 
0030 <span class="comment">% (C) 2009 Andy Adler. License: GPL version 2 or version 3</span>
0031 <span class="comment">% $Id: dm_2d_circ_pt_elecs.m 5763 2018-05-20 11:26:26Z aadler $</span>
0032 
0033 
0034 <span class="keyword">if</span> ischar(elec_pts) &amp;&amp; strcmp(elec_pts,<span class="string">'UNIT_TEST'</span>); <a href="#_sub3" class="code" title="subfunction do_unit_test">do_unit_test</a>; <span class="keyword">return</span>; <span class="keyword">end</span>
0035 <span class="keyword">if</span> ischar(elec_pts) &amp;&amp; strcmp(elec_pts,<span class="string">'CALIBRATE'</span>); <a href="#_sub4" class="code" title="subfunction do_calibrate">do_calibrate</a>; <span class="keyword">return</span>; <span class="keyword">end</span>
0036 
0037 copt.cache_obj = {elec_pts, spacing};
0038 copt.fstr = <span class="string">'dm_2d_circ_pt_elecs'</span>;
0039 fmdl = <a href="../../../eidors/tools/eidors_cache.html" class="code" title="function varargout=eidors_cache( command, varargin )">eidors_cache</a>(@<a href="#_sub1" class="code" title="subfunction fmdl = do_circ_pt_elecs( elec_pts, pfix, spacing )">do_circ_pt_elecs</a>,{elec_pts, pfix, spacing}, copt);
0040 
0041 <a name="_sub1" href="#_subfunctions" class="code">function fmdl = do_circ_pt_elecs( elec_pts, pfix, spacing )</a>
0042 params.base_spacing = spacing(1);
0043 params.refine_ratio = spacing(2);
0044 params.gradient     = spacing(3);
0045 
0046 bbox= [-1,-1;1,1];
0047 
0048 <a href="../../../eidors/tools/eidors_cache.html" class="code" title="function varargout=eidors_cache( command, varargin )">eidors_cache</a>(<span class="string">'boost_priority'</span>,-4);
0049 fmdl= <a href="dm_2d_pt_elecs.html" class="code" title="function fmdl = dm_2d_pt_elecs( elec_pts, pfix, params, shapefn, bbox);">dm_2d_pt_elecs</a>( elec_pts, [], params, @<a href="#_sub2" class="code" title="subfunction d= circle(p,params);">circle</a>, [-1,-1;1,1] );
0050 <a href="../../../eidors/tools/eidors_cache.html" class="code" title="function varargout=eidors_cache( command, varargin )">eidors_cache</a>(<span class="string">'boost_priority'</span>,+4);
0051 
0052 fmdl.name = sprintf(<span class="string">'dm_2d_circ_pt_elec'</span>);
0053 fmdl.normalize_measurements = 0; <span class="comment">%default</span>
0054 
0055 <a name="_sub2" href="#_subfunctions" class="code">function d= circle(p,params);</a>
0056   d = sqrt(sum(p.^2,2)) - 1; 
0057 
0058 <span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%% TESTING %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span>
0059 
0060 <a name="_sub3" href="#_subfunctions" class="code">function do_unit_test</a>
0061    elec_pts = {[1,0],[0,1;sin(0.2),cos(0.2)],[0.5,0.5]};
0062    fmdl= <a href="dm_2d_circ_pt_elecs.html" class="code" title="function fmdl = dm_2d_circ_pt_elecs( elec_pts, pfix, spacing);">dm_2d_circ_pt_elecs</a>( elec_pts, [], [0.15,10,0.05] );
0063    subplot(221); <a href="../../../eidors/graphics/matlab/show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(fmdl);
0064    <span class="keyword">for</span> i=1:length(elec_pts)
0065       <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(sprintf(<span class="string">'Elec%d(%d)'</span>,1,i), <span class="keyword">...</span>
0066          mean(fmdl.nodes(fmdl.electrode(i).nodes,:),1), mean(elec_pts{i},1), .01);
0067    <span class="keyword">end</span>
0068 
0069 
0070 <span class="comment">% Example:</span>
0071    n_elecs= 14; elec_width= 0.1; hw= elec_width/2;
0072    th = linspace(0,2*pi,n_elecs+1); th(end)=[];
0073    <span class="keyword">for</span> i=1:n_elecs;
0074       ti = th(i) + [hw;-hw];
0075       elec_pts{i} = [sin(ti),cos(ti)];
0076    <span class="keyword">end</span>
0077    fmdl= <a href="dm_2d_circ_pt_elecs.html" class="code" title="function fmdl = dm_2d_circ_pt_elecs( elec_pts, pfix, spacing);">dm_2d_circ_pt_elecs</a>( elec_pts, [], [0.10,10,0.02] );
0078    subplot(222); <a href="../../../eidors/graphics/matlab/show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(fmdl)
0079    <span class="keyword">for</span> i=1:length(elec_pts)
0080       <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(sprintf(<span class="string">'Elec%d(%d)'</span>,2,i), <span class="keyword">...</span>
0081          mean(fmdl.nodes(fmdl.electrode(i).nodes,:),1), mean(elec_pts{i},1), .01);
0082    <span class="keyword">end</span>
0083    <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level = eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'CHECK FIGURE - should have 3 and 16 electrodes'</span>,0);
0084 
0085 <span class="comment">% find example models that work well with the values defined in mk_common_model</span>
0086 <a name="_sub4" href="#_subfunctions" class="code">function do_calibrate</a>
0087 
0088 <span class="comment">% meas = calc_range(0.05*([1,1.1,1.2,1.4,1.6,2.0,2.5,3,4,5,7,10,15,20]),0,1)</span>
0089   meas = <a href="#_sub5" class="code" title="subfunction meas = calc_range(p1range,p2,p3)">calc_range</a>(0.02,3,0.10),<span class="comment">%- level 1</span>
0090 <span class="comment">% meas = calc_range(0.03,10,0.05),%- level 3</span>
0091 
0092 <span class="comment">% meas = calc_range(0.02,10,0.05),%- level 3</span>
0093 <span class="comment">% meas = calc_range(0.02,20,0.05),%- level 3</span>
0094  <span class="comment">% As a start, set p2 = 1. This is uniform, and we can choose the</span>
0095  <span class="comment">% target refinement levels, and calculate the centre mesh density</span>
0096  <span class="comment">% OR setting p3=1 also gives uniform</span>
0097 
0098 <a name="_sub5" href="#_subfunctions" class="code">function meas = calc_range(p1range,p2,p3)</a>
0099   n_elecs= 8; elec_width= 0.1; hw= elec_width/2;
0100   th = linspace(0,2*pi,n_elecs+1); th(end)=[];
0101   <span class="keyword">for</span> i=1:n_elecs;
0102      ti = th(i) + [hw;-hw];
0103      elec_pts{i} = [sin(ti),cos(ti)];
0104   <span class="keyword">end</span>
0105 
0106   <span class="keyword">for</span> i = 1:length(p1range)
0107      p1 = p1range(i);
0108      fmdl= <a href="dm_2d_circ_pt_elecs.html" class="code" title="function fmdl = dm_2d_circ_pt_elecs( elec_pts, pfix, spacing);">dm_2d_circ_pt_elecs</a>( elec_pts, [], [p1,p2,p3]);
0109      nd= fmdl.nodes; nn= size(nd,1);
0110      ne= size(fmdl.elems,1);
0111      nc= sum( nd(:,1).^2 + nd(:,2).^2 &lt; 0.5^2);
0112      nl= sum( (nd(:,1)-1).^2 + nd(:,2).^2 &lt; 0.2^2);
0113      meas(i,:) = [p1,p2,p3,[nn,ne,nc,nl]/1000];
0114 
0115   <span class="keyword">end</span>;
0116 <a href="../../../eidors/graphics/matlab/show_fem.html" class="code" title="function hh=show_fem( mdl, options)">show_fem</a>(fmdl)
0117</pre></div>
<hr><address>Generated on Fri 30-Dec-2022 20:46:51 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>