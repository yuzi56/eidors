<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of calc_slices</title>
  <meta name="keywords" content="calc_slices">
  <meta name="description" content="calc_slices (img, levels, clim  ) show slices at levels of an">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html v1.5 &copy; 2003-2005 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../../../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../../../index.html">Home</a> &gt;  <a href="../../index.html">eidors</a> &gt; <a href="#">graphics</a> &gt; <a href="index.html">matlab</a> &gt; calc_slices.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../../../index.html"><img alt="<" border="0" src="../../../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for eidors/graphics/matlab&nbsp;<img alt=">" border="0" src="../../../right.png"></a></td></tr></table>-->

<h1>calc_slices
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>calc_slices (img, levels, clim  ) show slices at levels of an</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="box"><strong>function rimg = calc_slices( img, levels ); </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre class="comment"> calc_slices (img, levels, clim  ) show slices at levels of an
             using a fast rendering algorithm
 img    = EIDORS image struct, or array of I images
 levels = any level definition accepted by level_model_slice

 PARAMETERS:
   img.calc_slices.filter % Filter to be applied to images
      Example:    img.calc_slices.filter = ones(3)/9
   img.calc_slices.scale  % Scaling to apply to images
   img.get_img_data.frame_select = which frames of image to display

 rimg= np x np x I x L where np is 128 by default

   np can be adjusted by calc_colours('npoints')
     or by setting
   img.fwd_model.mdl_slice_mapper.{npx, npy}
        see help of mdl_slice_mapper for more options

 See also: <a href="level_model_slice.html" class="code" title="function [out, out2, out3] = level_model_slice(varargin)">LEVEL_MODEL_SLICE</a></pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../eidors/eidors_msg.html" class="code" title="function log_level = eidors_msg( message, varargin )">eidors_msg</a>	EIDORS_MSG eidors progress and status messages</li><li><a href="calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>	[colours,scl_data]= calc_colours(img, set_value, do_colourbar)</li><li><a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>	calc_slices (img, levels, clim  ) show slices at levels of an</li><li><a href="level_model_slice.html" class="code" title="function [out, out2, out3] = level_model_slice(varargin)">level_model_slice</a>	LEVEL_MODEL_SLICE - level 3D points for slicing at z=0</li><li><a href="mdl_slice_mapper.html" class="code" title="function map = mdl_slice_mapper( fmdl, maptype )">mdl_slice_mapper</a>	MDL_SLICE_MAPPER: map pixels to FEM elements or nodes</li><li><a href="../../../eidors/models/data_mapper.html" class="code" title="function img = data_mapper(img, reverse)">data_mapper</a>	DATA_MAPPER maps img.params data to elem or node data</li><li><a href="../../../eidors/models/mdl_dim.html" class="code" title="function num = mdl_dim( mdl );">mdl_dim</a>	MDL_DIM: dimension of model space (are nodes in 2D or 3D space)</li><li><a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>	MK_COMMON_MODEL: make common EIT models</li><li><a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>	MK_IMAGE: create eidors image object</li><li><a href="../../../eidors/solvers/calc_jacobian_bkgnd.html" class="code" title="function img_bkgnd = calc_jacobian_bkgnd( inv_model )">calc_jacobian_bkgnd</a>	CALC_JACOBIAN_BKGND: calculate background image around</li><li><a href="../../../eidors/solvers/get_img_data.html" class="code" title="function [img_data, n_images]= get_img_data(img)">get_img_data</a>	GET_IMG_DATA: get parameter data from eidors image object</li><li><a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>	UNIT_TEST_CMP: compare matrices in eidors output</li></ul>
This function is called by:
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="../../../eidors/algorithms/calc_posn_resolution.html" class="code" title="function [br,pos]= calc_posn_resolution( img, fwd_model)">calc_posn_resolution</a>	CALC_POSN_RESOLUTION: calculate posn and resolution of a target</li><li><a href="../../../eidors/algorithms/eval_GREIT_fig_merit.html" class="code" title="function params = eval_GREIT_fig_merit(imgs, xyzr_pt)">eval_GREIT_fig_merit</a>	EVAL_GREIT_FIG_MERIT: calculate GREIT figures of merit for images</li><li><a href="animate_reconstructions.html" class="code" title="function fname_out= animate_reconstructions(fname, imgs);">animate_reconstructions</a>	animate_reconstructions(fname, imgs);</li><li><a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>	calc_slices (img, levels, clim  ) show slices at levels of an</li><li><a href="mk_mosaic.html" class="code" title="function r_img = mk_mosaic(rimg, sep, vh, n_col)">mk_mosaic</a>	MK_MOSAIC Arrange multidimensional image matrix for display.</li><li><a href="show_slices.html" class="code" title="function out_img= show_slices( img, levels, vh )">show_slices</a>	out_img = show_slices (img, levels ) show slices at levels of an</li><li><a href="../../../eidors/interface/eidors_saveimg.html" class="code" title="function eidors_saveimg( img, fname, format, pp )">eidors_saveimg</a>	EIDORS saveimg - save reconstructed image files in formats</li><li><a href="../../../eidors/interface/igt2img.html" class="code" title="function img = igt2img(igt)">igt2img</a>	IGT2IMG constructs an EIDORS IMG struct from an IGT frames-by-912 matrix.</li><li><a href="../../../eidors/interface/img2igt.html" class="code" title="function igt = img2igt(img)">img2igt</a>	IMG2IGT returns an IGT-compatible image matrix from any EIDORS</li><li><a href="../../../eidors/models/mk_GREIT_model.html" class="code" title="function [imdl, weight]= mk_GREIT_model( fmdl, radius, weight, options )">mk_GREIT_model</a>	MK_GREIT_MODEL: make EIDORS inverse models using the GREIT approach</li><li><a href="../../../eidors/models/mk_pixel_slice.html" class="code" title="function [imdl fmdl] = mk_pixel_slice(imdl,level,opt)">mk_pixel_slice</a>	MK_PIXEL_SLICE create a pixel model to reconstruct on</li><li><a href="../../../eidors/models/solve_RM_2Dslice.html" class="code" title="function imdl = solve_RM_2Dslice(imdl, sel_fcn)">solve_RM_2Dslice</a>	SOLVE_RM_2DSLICE: cut slices out of a 3D model</li><li><a href="../../../eidors/solvers/inverse/calc_image_SNR.html" class="code" title="function [SNRmean, SE, debug] = calc_image_SNR(imdl, hyperparameter, doPlot)">calc_image_SNR</a>	% CALC_IMAGE_SNR: Calculates the signal-to-noise ratio (SNR) in the image</li><li><a href="../../../eidors/tests/test_colour_direction.html" class="code" title="">test_colour_direction</a>	Test colour mapping</li><li><a href="../../../eidors/tools/test_performance.html" class="code" title="function [r, params] =  test_performance( imdls, fmdl );">test_performance</a>	TEST_PERFORMANCE: test of difference reconstruction algorithms</li><li><a href="../../../eidors/tools/test_performance_img.html" class="code" title="function [params_img] =  test_performance_img( imdls, fmdl );">test_performance_img</a>	TEST_PERFORMANCE: test of difference reconstruction algorithms</li></ul>
<!-- crossreference -->

<h2><a name="_subfunctions"></a>SUBFUNCTIONS <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<ul style="list-style-image:url(../../../matlabicon.gif)">
<li><a href="#_sub1" class="code">function rimg = calc_this_slice( img, levels, np)</a></li><li><a href="#_sub2" class="code">function rimg= calc_image_nearestnodes( node_data, fwd_model)</a></li><li><a href="#_sub3" class="code">function rimg= calc_image_nodes( node_data, fwd_model)</a></li><li><a href="#_sub4" class="code">function rimg= calc_image_elems( elem_data, fwd_model)</a></li><li><a href="#_sub5" class="code">function  rimg = filter_image(rimg, filt);</a></li><li><a href="#_sub6" class="code">function do_unit_test</a></li></ul>

<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../../../up.png"></a></h2>
<div class="fragment"><pre>0001 <a name="_sub0" href="#_subfunctions" class="code">function rimg = calc_slices( img, levels );</a>
0002 <span class="comment">% calc_slices (img, levels, clim  ) show slices at levels of an</span>
0003 <span class="comment">%             using a fast rendering algorithm</span>
0004 <span class="comment">% img    = EIDORS image struct, or array of I images</span>
0005 <span class="comment">% levels = any level definition accepted by level_model_slice</span>
0006 <span class="comment">%</span>
0007 <span class="comment">% PARAMETERS:</span>
0008 <span class="comment">%   img.calc_slices.filter % Filter to be applied to images</span>
0009 <span class="comment">%      Example:    img.calc_slices.filter = ones(3)/9</span>
0010 <span class="comment">%   img.calc_slices.scale  % Scaling to apply to images</span>
0011 <span class="comment">%   img.get_img_data.frame_select = which frames of image to display</span>
0012 <span class="comment">%</span>
0013 <span class="comment">% rimg= np x np x I x L where np is 128 by default</span>
0014 <span class="comment">%</span>
0015 <span class="comment">%   np can be adjusted by calc_colours('npoints')</span>
0016 <span class="comment">%     or by setting</span>
0017 <span class="comment">%   img.fwd_model.mdl_slice_mapper.{npx, npy}</span>
0018 <span class="comment">%        see help of mdl_slice_mapper for more options</span>
0019 <span class="comment">%</span>
0020 <span class="comment">% See also: LEVEL_MODEL_SLICE</span>
0021 
0022 <span class="comment">% (C) 2006-2022 Andy Adler and Bartek Grychtol.</span>
0023 <span class="comment">% License: GPL version 2 or version 3</span>
0024 <span class="comment">% $Id: calc_slices.m 6364 2022-05-05 12:55:54Z bgrychtol $</span>
0025 
0026 <span class="keyword">if</span> ischar(img) &amp;&amp; strcmp(img,<span class="string">'UNIT_TEST'</span>); <a href="#_sub6" class="code" title="subfunction do_unit_test">do_unit_test</a>; <span class="keyword">return</span>; <span class="keyword">end</span>
0027 
0028 np = <a href="calc_colours.html" class="code" title="function [colours,scl_data]= calc_colours(img, set_value, do_colourbar)">calc_colours</a>(<span class="string">'npoints'</span>);
0029 <span class="keyword">try</span> np = img(1).calc_colours.npoints; <span class="keyword">end</span>
0030 
0031 <span class="keyword">if</span> nargin &lt; 2, levels = []; <span class="keyword">end</span>
0032 
0033 <span class="keyword">if</span> isfield(img, <span class="string">'calc_slices'</span>) &amp;&amp; isfield(img.calc_slices, <span class="string">'levels'</span>)
0034     warning(<span class="string">'EIDORS:CALC_SLICES:DeprecatedInterface'</span>, <span class="keyword">...</span>
0035         [<span class="string">'Ingoring deprecated img.calc_slices.levels definition. '</span><span class="keyword">...</span>
0036         <span class="string">'Use img.fwd_model.mdl_slice_mapper.level instead. '</span><span class="keyword">...</span>
0037         <span class="string">'See help level_model_slice for valid inputs.'</span>])
0038     img.calc_slices = rmfield(img.calc_slices, <span class="string">'levels'</span>);
0039 <span class="keyword">end</span>
0040 
0041 
0042 
0043 img = <a href="../../../eidors/models/data_mapper.html" class="code" title="function img = data_mapper(img, reverse)">data_mapper</a>(img);
0044 
0045 <span class="comment">% Assume all fwd_models are same dimension (all 3D or 2D no mixed dims)</span>
0046 <span class="keyword">if</span> <a href="../../../eidors/models/mdl_dim.html" class="code" title="function num = mdl_dim( mdl );">mdl_dim</a>(img(1))==2 
0047     <span class="keyword">if</span> nargin&gt;1
0048         <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level = eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'Specified levels ignored for 2D FEM'</span>, 4);
0049     <span class="keyword">end</span>
0050     <span class="keyword">if</span> isfield(img(1).fwd_model,<span class="string">'mdl_slice_mapper'</span>) &amp;&amp; isfield(img(1).fwd_model.mdl_slice_mapper, <span class="string">'level'</span>)
0051         <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level = eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'mdl_slice_mapper.level definition ignored for 2D FEM'</span>,4); 
0052         <span class="keyword">for</span> i = 1:numel(img)
0053             img(i).fwd_model.mdl_slice_mapper = rmfield(img(i).fwd_model.mdl_slice_mapper,<span class="string">'level'</span>);
0054         <span class="keyword">end</span>
0055     <span class="keyword">end</span>
0056     levels= [Inf,Inf,0];
0057 <span class="keyword">elseif</span> <a href="../../../eidors/models/mdl_dim.html" class="code" title="function num = mdl_dim( mdl );">mdl_dim</a>(img(1))==3 &amp;&amp; isempty(levels)
0058    levels = [Inf Inf mean(img.fwd_model.nodes(:,3))];
0059    <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level = eidors_msg( message, varargin )">eidors_msg</a>(<span class="string">'calc_slices: no levels specified, assuming an xy plane'</span>,2);
0060 <span class="keyword">end</span>
0061 
0062 
0063 rimg = [];
0064 <span class="keyword">for</span> i=1:length(img)
0065    rimg = cat(3, rimg, <a href="#_sub1" class="code" title="subfunction rimg = calc_this_slice( img, levels, np)">calc_this_slice</a>( img(i), levels, np) );
0066 <span class="keyword">end</span>
0067 
0068 <a name="_sub1" href="#_subfunctions" class="code">function rimg = calc_this_slice( img, levels, np)</a>
0069     <span class="comment">% If scalar levels then we just create that many cut planes on z-dimension</span>
0070     fwd_model = img.fwd_model;
0071     
0072     <span class="keyword">if</span> ~isfield(fwd_model,<span class="string">'mdl_slice_mapper'</span>)
0073         fwd_model.mdl_slice_mapper.npoints = np;
0074     <span class="keyword">end</span>
0075     <span class="keyword">if</span> isfield(fwd_model.mdl_slice_mapper, <span class="string">'level'</span>)
0076       <a href="../../../eidors/eidors_msg.html" class="code" title="function log_level = eidors_msg( message, varargin )">eidors_msg</a>(3, <span class="string">'Using level definition from the mdl_slice_mapper.level field.'</span>);
0077       levels = fwd_model.mdl_slice_mapper.level; 
0078     <span class="keyword">end</span>
0079     
0080     nodes = {fwd_model.nodes};
0081     <span class="keyword">if</span> size(fwd_model.nodes,2)==3 &amp;&amp; size(fwd_model.elems,2) &gt; 3 
0082         nodes = <a href="level_model_slice.html" class="code" title="function [out, out2, out3] = level_model_slice(varargin)">level_model_slice</a>(fwd_model.nodes, levels, <span class="string">'all'</span>);
0083         
0084         <span class="comment">% we'll level by replacing nodes. Disable.</span>
0085         lvl = struct(<span class="string">'rotation_matrix'</span>,eye(3), <span class="string">'centre'</span>, zeros(1,3));
0086         fwd_model.mdl_slice_mapper.level = lvl;
0087     <span class="keyword">end</span>
0088     
0089     [data, n_images] = <a href="../../../eidors/solvers/get_img_data.html" class="code" title="function [img_data, n_images]= get_img_data(img)">get_img_data</a>(img);
0090     
0091     <span class="keyword">if</span> ~any(isfield(img, {<span class="string">'elem_data'</span>, <span class="string">'node_data'</span>}))
0092        error(<span class="string">'img does not have a data field'</span>);
0093     <span class="keyword">end</span>
0094     n_levels = numel(nodes);
0095     <span class="keyword">for</span> lev_no = fliplr(1:n_levels)
0096         fwd_model.nodes = nodes{lev_no};
0097         <span class="keyword">if</span> isfield(img,<span class="string">'elem_data'</span>)
0098           rimg(:,:,:,lev_no) = <a href="#_sub4" class="code" title="subfunction rimg= calc_image_elems( elem_data, fwd_model)">calc_image_elems</a>( data, fwd_model);
0099         <span class="keyword">elseif</span> isfield(img,<span class="string">'node_data'</span>)
0100           rimg(:,:,:,lev_no) = <a href="#_sub3" class="code" title="subfunction rimg= calc_image_nodes( node_data, fwd_model)">calc_image_nodes</a>( data, fwd_model);
0101         <span class="keyword">end</span>
0102     <span class="keyword">end</span>
0103     
0104     <span class="comment">% FILTER IMAGE</span>
0105     <span class="keyword">try</span>   
0106         filt = img.calc_slices.filter; 
0107     <span class="keyword">catch</span>
0108         filt = 1; 
0109     <span class="keyword">end</span>
0110     <span class="keyword">try</span>   
0111         scal = img.calc_slices.scale; 
0112     <span class="keyword">catch</span>
0113         scal = 1; 
0114     <span class="keyword">end</span>
0115 
0116     filt = scal * ( filt/sum(filt(:)) );
0117     rimg = <a href="#_sub5" class="code" title="subfunction  rimg = filter_image(rimg, filt);">filter_image</a>(rimg, filt);
0118 
0119 <span class="comment">% Calculate an image by mapping it onto the node_ptr matrix</span>
0120 <span class="comment">% This makes a blocky image to nearest node -&gt; no longer used</span>
0121 <a name="_sub2" href="#_subfunctions" class="code">function rimg= calc_image_nearestnodes( node_data, fwd_model)</a>
0122 
0123    node_ptr = <a href="mdl_slice_mapper.html" class="code" title="function map = mdl_slice_mapper( fmdl, maptype )">mdl_slice_mapper</a>( fwd_model, <span class="string">'node'</span> );
0124 
0125    backgnd= NaN;
0126    n_images= size(node_data,2);
0127    rval= [backgnd*ones(1,n_images); node_data];
0128    rimg= reshape( rval(node_ptr+1,:), [size(node_ptr), n_images]);
0129 
0130 <span class="comment">% Calculate an image by interpolating it onto the elem_ptr matrix</span>
0131 <a name="_sub3" href="#_subfunctions" class="code">function rimg= calc_image_nodes( node_data, fwd_model)</a>
0132 
0133    nd_interp= <a href="mdl_slice_mapper.html" class="code" title="function map = mdl_slice_mapper( fmdl, maptype )">mdl_slice_mapper</a>( fwd_model, <span class="string">'nodeinterp'</span> );
0134    elem_ptr = <a href="mdl_slice_mapper.html" class="code" title="function map = mdl_slice_mapper( fmdl, maptype )">mdl_slice_mapper</a>( fwd_model, <span class="string">'elem'</span> );
0135    [sx,sy]= size(elem_ptr);
0136 
0137    node_ptr = fwd_model.elems; node_ptr = [0*node_ptr(1,:);node_ptr];
0138    node_ptr = reshape( node_ptr( elem_ptr+1, :), sx, sy, []);
0139 
0140    n_images = size(node_data,2);
0141    rimg= zeros(sx, sy, n_images);
0142    backgnd= NaN;
0143    
0144    <span class="keyword">for</span> ni = 1:n_images
0145      znd = [backgnd;node_data(:,ni)]; <span class="comment">% add NaN for background</span>
0146      rimg(:,:,ni) = sum( znd(node_ptr+1) .* nd_interp, 3); 
0147    <span class="keyword">end</span>
0148 
0149 
0150 <span class="comment">% Calculate an image by mapping it onto the elem_ptr matrix</span>
0151 <a name="_sub4" href="#_subfunctions" class="code">function rimg= calc_image_elems( elem_data, fwd_model)</a>
0152 
0153    elem_ptr = <a href="mdl_slice_mapper.html" class="code" title="function map = mdl_slice_mapper( fmdl, maptype )">mdl_slice_mapper</a>( fwd_model, <span class="string">'elem'</span>);
0154 
0155    backgnd= NaN;
0156    n_images= size(elem_data,2);
0157    rval= backgnd*ones(size(elem_data)+[1,0]);
0158    rval(2:<span class="keyword">end</span>,:) = elem_data;
0159    rimg= reshape( rval(elem_ptr+1,:), [size(elem_ptr), n_images]);
0160 
0161 
0162 <a name="_sub5" href="#_subfunctions" class="code">function  rimg = filter_image(rimg, filt);</a>
0163     
0164    <span class="comment">%%% Total MATLAB BS )(*&amp;#$)(*#&amp;@</span>
0165    <span class="comment">%%% the &amp;&amp; operator used to short circuit. Now it doesn't</span>
0166    <span class="comment">%%% How the (*&amp;)(*&amp; can anyone take this language seriously</span>
0167    <span class="comment">% all(size(filt*scal) == [1,1]) &amp;&amp; filt*scal == 1</span>
0168    <span class="keyword">if</span> all(size(filt)==1) <span class="keyword">if</span> filt == 1; <span class="keyword">return</span>; <span class="keyword">end</span> ; <span class="keyword">end</span>
0169 
0170    [sz1,sz2,sz3,sz4] = size(rimg);
0171    <span class="keyword">for</span> j1 = 1:sz3; <span class="keyword">for</span> j2 = 1:sz4; 
0172       rsl = rimg(:,:,j1,j2);
0173 
0174       rna = isnan(rsl);
0175       rsl(rna) = 0;
0176       rsl = conv2(rsl, filt, <span class="string">'same'</span>);
0177       rsl(rna) = NaN;
0178 
0179       rimg(:,:,j1,j2) = rsl;
0180    <span class="keyword">end</span>; <span class="keyword">end</span>
0181 
0182 <a name="_sub6" href="#_subfunctions" class="code">function do_unit_test</a>
0183    img = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>( <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'a2c2'</span>,8));
0184    img.calc_colours.npoints = 8; 
0185 
0186    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0187    imt = NaN*ones(8); imt(2:7,2:7) = 1; imt(3:6,:) = 1; imt(:,3:6) = 1; 
0188    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 2d 1'</span>, imc, imt);
0189 
0190    imn = rmfield(img,<span class="string">'elem_data'</span>);
0191    imn.node_data = ones(size(imn.fwd_model.nodes,1),1);
0192    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(imn);
0193    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 2d 2'</span>, imc, imt, 1e-14);
0194 
0195    img.elem_data(1:4) = 2;
0196    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0197    imt(4:5,4:5) = 2; 
0198    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 2d 3'</span>, imc, imt);
0199 
0200    imn.node_data(1:5) = 2;
0201    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(imn);
0202    imt(3:6,3:6) = 1; imt(4:5,3:6) = 1.292893218813452;
0203    imt(3:6,4:5) = 1.292893218813452; imt(4:5,4:5) = 2;
0204    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 2d 4'</span>, imc, imt, 1e-14);
0205 
0206    imn.node_data(:) = 1; imn.node_data(1) = 4;
0207    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(imn);
0208    imt(3:6,3:6) = 1; imt(4:5,4:5) = 1.878679656440358; 
0209    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 2d 5'</span>, imc, imt, 1e-14);
0210 
0211    imn.calc_colours.npoints = 7; 
0212    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(imn);
0213    imt = NaN*ones(7); imt(3:5,:) = 1; imt(:,3:5)= 1; imt(2:6,2:6)= 1;imt(4,4) = 4; 
0214    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 2d 6'</span>, imc, imt, 1e-14);
0215 
0216 
0217 <span class="comment">% 3D Tests</span>
0218    img = <a href="../../../eidors/solvers/calc_jacobian_bkgnd.html" class="code" title="function img_bkgnd = calc_jacobian_bkgnd( inv_model )">calc_jacobian_bkgnd</a>( <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'n3r2'</span>,[16,2]));
0219    img.calc_colours.npoints = 8; 
0220    imn = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img,[inf,inf,1]);
0221 
0222    imt = NaN*ones(8); imt(3:6,:) = 1; imt(:,3:6) = 1; imt(2:7,2:7) = 1; 
0223    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 3d 1'</span>, imn, imt);
0224 
0225    img.calc_colours.npoints = 12; 
0226    imn = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img,[inf,0,inf]);
0227    imt = NaN*ones(12); imt(:,3:10) = 1; 
0228    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 3d 2'</span>, imn, imt);
0229 
0230    <span class="comment">% Should have no effect</span>
0231    img.fwd_model.nodes(:,3) = img.fwd_model.nodes(:,3)-1;
0232    imn = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img,[inf,0,inf]); 
0233    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs 3d 3'</span>, imn, imt);
0234 
0235 
0236 <span class="comment">% multi image struct</span>
0237    img = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>( <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'a2c2'</span>,8));
0238    img.calc_colours.npoints = 8; 
0239    img(2) = img;
0240    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img); 
0241    imt = NaN*ones(8); imt(3:6,:) = 1; imt(:,3:6) = 1; imt(2:7,2:7) = 1; 
0242    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs mult 1'</span>, imc, cat(3,imt,imt));
0243 
0244    imgb = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>( <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'b2c2'</span>,8));
0245    imgb.calc_colours.npoints = 8; 
0246    img(3)=imgb;
0247    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img); 
0248    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'cs mult 2'</span>, imc, cat(3,imt,imt,imt));
0249 
0250    imdl = <a href="../../../eidors/models/mk_common_model.html" class="code" title="function inv_mdl= mk_common_model( str, n_elec, varargin )">mk_common_model</a>(<span class="string">'c2t2'</span>,16);
0251    img = <a href="../../../eidors/models/mk_image.html" class="code" title="function img= mk_image(mdl, elem_data, params, name)">mk_image</a>(imdl,1);
0252    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0253    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'size e  1'</span>, size(imc), [64,64]);
0254 
0255    img.calc_colours.npoints = 40;
0256    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0257    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'size e  2'</span>, size(imc), [40,40]);
0258 
0259    img.fwd_model.mdl_slice_mapper.npx = 22;
0260    img.fwd_model.mdl_slice_mapper.npy = 32;
0261    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0262    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'size e  3'</span>, size(imc), [32,22]);
0263 
0264    img.fwd_model = rmfield(img.fwd_model,<span class="string">'mdl_slice_mapper'</span>);
0265    img.fwd_model.mdl_slice_mapper.x_pts = linspace(-150,150,20);
0266    img.fwd_model.mdl_slice_mapper.y_pts =-linspace(-150,150,23);
0267    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0268    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'size e  4'</span>, size(imc), [23,20]);
0269 
0270    img = rmfield(img,<span class="string">'elem_data'</span>);
0271    img.node_data =  ones(size(img.fwd_model.nodes,1),1);
0272    img.node_data =  (1:size(img.fwd_model.nodes,1))';
0273    img.fwd_model = rmfield(img.fwd_model,<span class="string">'mdl_slice_mapper'</span>);
0274    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0275    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'size n  1'</span>, size(imc), [40,40]);
0276 
0277    im2= img;
0278    im2.node_data =  ones(size(img.fwd_model.nodes,1),5);
0279    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(im2);
0280    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'size n x5'</span>, size(imc), [40,40,5]);
0281    im2.get_img_data.frame_select = 2:3;
0282    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(im2);
0283    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'size n x2'</span>, size(imc), [40,40,2]);
0284 
0285    img.fwd_model.mdl_slice_mapper.x_pts = linspace(-150,150,20);
0286    img.fwd_model.mdl_slice_mapper.y_pts =-linspace(-150,150,23);
0287    imc = <a href="calc_slices.html" class="code" title="function rimg = calc_slices( img, levels );">calc_slices</a>(img);
0288    <a href="../../../eidors/tools/unit_test_cmp.html" class="code" title="function res = unit_test_cmp(txt,a,b,tol)">unit_test_cmp</a>(<span class="string">'size n  2'</span>, size(imc), [23,20]);</pre></div>
<hr><address>Generated on Fri 30-Dec-2022 20:46:51 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/" title="Matlab Documentation in HTML">m2html</a></strong> &copy; 2005</address>
</body>
</html>